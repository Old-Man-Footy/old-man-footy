<!-- Hero Section -->
<section class="hero-banner bg-primary py-4" data-page-id="homepage">
    <div class="hero-background-pattern"></div>
    <div class="container position-relative">
        <div class="row align-items-center">
            <div class="col-lg-4 text-center">
                <div class="logo-container">
                    <img src="/icons/old-man-footy.svg" alt="Old Man Footy Logo" class="img-fluid hero-logo">
                </div>
            </div>
            <div class="col-lg-8">
                <div class="hero-content">
                    <h1 class="hero-title mb-3">Discover Masters Rugby League</h1>
                    <div class="hero-description mb-4">
                        <p class="lead">The 'Old Man Footy' website is your central hub for discovering Masters (Over 35's)
                            Rugby League carnivals and clubs across Australia. find a local club, or explore carnivals 
                            in local communities nationwide all with comprehensive carnival details readily available 
                            to help you plan your next Masters trip.</p>
                    </div>
                    <div class="hero-actions d-flex gap-3 flex-wrap">
                        <a href="/carnivals" class="btn btn-light btn-lg hero-btn">
                            <i class="bi bi-calendar-carnival"></i> View All Carnivals
                        </a>
                        <% if (!user) { %>
                            <a href="/auth/register" class="btn btn-outline-light btn-lg hero-btn">
                                <i class="bi bi-person-plus"></i> Register as Club Delegate
                            </a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Runner -->
<section class="stats-runner bg-dark py-2">
    <div class="container">
        <div class="row text-center">
            <div class="<%= stats.clubsCount >= 10 ? 'col-6 col-md-4' : 'col-6' %>">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.totalCarnivals %></span>
                    <span class="stat-label-small">Total Carnivals</span>
                </div>
            </div>
            <div class="<%= stats.clubsCount >= 10 ? 'col-6 col-md-4' : 'col-6' %>">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.upcomingCount %></span>
                    <span class="stat-label-small">Upcoming Carnivals</span>
                </div>
            </div>
            <% if (stats.clubsCount >= 10) { %>
            <div class="col-12 col-md-4 mt-2 mt-md-0">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.clubsCount %></span>
                    <span class="stat-label-small">Registered Clubs</span>
                </div>
            </div>
            <% } %>
        </div>
    </div>
</section>

<!-- Upcoming Carnivals Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="h3 mb-0">Upcoming Carnivals</h2>
                    <a href="/carnivals" class="btn btn-outline-primary">View All</a>
                </div>
                
                <% if (carnivals && carnivals.length > 0) { %>
                    <div class="row">
                        <% carnivals.forEach(carnival => { %>
                            <div class="col-md-6 mb-4">
                                <div class="card shadow-sm">
                                    <div class="row g-0">
                                        <div class="col-8">
                                            <div class="card-body p-3">
                                                <h6 class="card-title mb-2"><%= carnival.title %></h6>
                                                <div class="mb-1">
                                                    <small class="text-muted">
                                                        <%- include('partials/carnival-date', { 
                                                            carnival: carnival, 
                                                            format: 'compact',
                                                            showIcon: true,
                                                            addClass: ''
                                                        }) %>
                                                    </small>
                                                </div>
                                                <div class="mb-2">
                                                    <small class="text-muted">
                                                        <%- include('partials/carnival-address', { 
                                                            carnival: carnival, 
                                                            layout: 'inline',
                                                            truncate: 30,
                                                            addressClass: 'text-muted'
                                                        }) %>
                                                    </small>
                                                </div>
                                                <div class="mb-2">
                                                    <span class="badge state-<%= carnival.state.toLowerCase() %>"><%= carnival.state %></span>
                                                </div>
                                                <div class="d-flex gap-1">
                                                    <a href="/carnivals/<%= carnival.id %>" class="btn btn-primary btn-sm">
                                                        <i class="bi bi-eye"></i> View
                                                    </a>
                                                    <% if (carnival.registrationLink) { %>
                                                        <a href="<%= carnival.registrationLink %>" class="btn btn-outline-light btn-sm" target="_blank">
                                                            <i class="bi bi-person-plus"></i> Register
                                                        </a>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4 d-flex align-items-center justify-content-center p-3">
                                            <% 
                                            // Show carnival logo first, then fall back to hosting club logo, then to missing.svg
                                            const logoUrl = carnival.clubLogoURL || (carnival.creator && carnival.creator.club && carnival.creator.club.logoUrl) || '/icons/missing.svg';
                                            %>
                                            <img src="<%= logoUrl %>" alt="Club Logo" 
                                                 class="img-fluid" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x display-4 text-muted mb-3"></i>
                        <h4 class="text-muted">No upcoming carnivals found</h4>
                        <p class="text-muted">Check back later or contact your local club to add their carnival.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>

<!-- Image Carousel Section -->
<% if (carouselImages && carouselImages.length > 0) { %>
<section class="py-4 bg-tertiary" data-carousel-images='<%= JSON.stringify(carouselImages) %>'>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h3 class="text-center mb-4">Community Gallery</h3>
                <p class="text-center text-muted mb-4">Recent photos from our Masters Rugby League community</p>
            </div>
        </div>
        
        <div class="image-carousel-container">
            <div class="image-carousel" id="imageCarousel">
                <div class="carousel-track-container">
                    <div class="carousel-track">
                        <% carouselImages.forEach((image, index) => { %>
                            <div class="carousel-slide <%= index === 0 ? 'current-slide' : '' %>" data-source="<%= image.source %>" data-type="<%= image.type %>">
                                <div class="carousel-image-wrapper">
                                    <img src="<%= image.url %>" alt="<%= image.source %> photo" class="carousel-image" loading="lazy">
                                    <div class="carousel-image-overlay">
                                        <div class="carousel-image-info">
                                            <span class="badge bg-primary"><%= image.source %></span>
                                            <% if (image.type === 'gallery') { %>
                                                <span class="badge bg-secondary">Gallery</span>
                                            <% } else if (image.type === 'promotional') { %>
                                                <span class="badge bg-tertiary">Promo</span>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
                
                <!-- Navigation buttons -->
                <button class="carousel-button carousel-button--left" id="carouselPrev">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="carousel-button carousel-button--right" id="carouselNext">
                    <i class="bi bi-chevron-right"></i>
                </button>
                
                <!-- Dots indicator -->
                <div class="carousel-nav">
                    <% carouselImages.forEach((image, index) => { %>
                        <button class="carousel-indicator <%= index === 0 ? 'current-slide' : '' %>" data-slide="<%= index %>"></button>
                    <% }) %>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-3">
            <small class="text-muted">
                Showing recent photos from carnivals, clubs, and sponsors • 
                <span id="carouselStats"><%= carouselImages.length %> images</span>
            </small>
        </div>
    </div>
</section>
<% } %>

<!-- Email Subscription Section -->
<section id="subscribe" class="bg-light py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="h3 mb-4">Stay Updated</h2>
                <p class="mb-4">Subscribe to receive notifications about new carnivals in your selected states.</p>
                
                <form method="POST" action="/subscribe" class="needs-validation" novalidate id="subscribeForm">
                    <!-- Bot protection: Honeypot field (hidden) -->
                    <input type="text" name="website" style="display: none;" tabindex="-1" autocomplete="off">
                    
                    <!-- Bot protection: Timestamp field -->
                    <input type="hidden" name="form_timestamp" id="main_form_timestamp">
                    
                    <div class="row g-3 justify-content-center">
                        <div class="col-md-6">
                            <input type="email" class="form-control" name="email" placeholder="Enter your email" required>
                            <div class="invalid-feedback">Please provide a valid email.</div>
                        </div>
                        <div class="col-md-4">
                            <!-- Modern compact state selector -->
                            <div class="state-selector-container">
                                <div class="state-selector-dropdown">
                                    <button type="button" class="form-control state-selector-toggle" id="stateToggle" aria-expanded="false">
                                        <span class="selected-text">Choose states...</span>
                                        <i class="bi bi-chevron-down float-end"></i>
                                    </button>
                                    <div class="state-selector-menu" id="stateMenu">
                                        <div class="state-selector-header">
                                            <button type="button" class="btn btn-link btn-sm p-0" id="selectAll">Select All</button>
                                            <button type="button" class="btn btn-link btn-sm p-0" id="selectNone">Clear All</button>
                                        </div>
                                        <div class="state-options">
                                            <% AUSTRALIAN_STATES.forEach(state => { %>
                                                <label class="state-option">
                                                    <input type="checkbox" name="state" value="<%= state %>" class="state-checkbox">
                                                    <span class="state-badge state-<%= state.toLowerCase() %>"><%= state %></span>
                                                </label>
                                            <% }) %>
                                        </div>
                                    </div>
                                </div>
                                <div class="invalid-feedback">Please select at least one state.</div>
                                <div class="form-text">Select the states you're interested in</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-envelope"></i> Subscribe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- MySideline Integration Section -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h2 class="h3 mb-4">Official Registration</h2>
                <p class="mb-4">
                    All official Masters Rugby League registrations are processed through MySideline. 
                    Find and register for Masters carnivals across Australia.
                </p>
                <a href="<%= process.env.MYSIDELINE_URL || '#' %>" class="btn btn-light btn-lg" target="_blank">
                    <i class="bi bi-box-arrow-up-right"></i> Register on MySideline
                </a>
            </div>
            <div class="col-lg-6 text-center">
                <i class="bi bi-person-check display-1 text-success"></i>
            </div>
        </div>
    </div>
</section>

<script type="module" src="/js/index.js"></script>
<script src="/js/state-selector.js"></script>
<%- include('partials/help-modal.ejs', { modalId: 'help-index' }) %>