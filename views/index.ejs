<!-- Hero Section -->
<section class="hero-banner bg-primary text-white py-4">
    <div class="hero-background-pattern"></div>
    <div class="container position-relative">
        <div class="row align-items-center">
            <div class="col-lg-4 text-center">
                <div class="logo-container">
                    <img src="/icons/old-man-footy.svg" alt="Old Man Footy Logo" class="img-fluid hero-logo">
                </div>
            </div>
            <div class="col-lg-8">
                <div class="hero-content">
                    <h1 class="hero-title mb-3">Discover Masters Rugby League</h1>
                    <div class="hero-description mb-4">
                        <p class="lead">The 'Old Man Footy' website is your central hub for discovering Masters 
                            Rugby League carnivals and clubs across Australia. find a local club, or explore carnivals 
                            in local communities nationwide all with comprehensive event details readily available 
                            to help you plan your next Masters experience.</p>
                    </div>
                    <div class="hero-actions d-flex gap-3 flex-wrap">
                        <a href="/carnivals" class="btn btn-success btn-lg hero-btn">
                            <i class="bi bi-calendar-event"></i> View All Carnivals
                        </a>
                        <% if (!user) { %>
                            <a href="/auth/register" class="btn btn-outline-success btn-lg hero-btn">
                                <i class="bi bi-person-plus"></i> Register as Club Delegate
                            </a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Runner -->
<section class="stats-runner bg-dark text-white py-2">
    <div class="container">
        <div class="row text-center">
            <div class="<%= stats.clubsCount >= 10 ? 'col-6 col-md-4' : 'col-6' %>">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.totalCarnivals %></span>
                    <span class="stat-label-small">Total Carnivals</span>
                </div>
            </div>
            <div class="<%= stats.clubsCount >= 10 ? 'col-6 col-md-4' : 'col-6' %>">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.upcomingCount %></span>
                    <span class="stat-label-small">Upcoming Events</span>
                </div>
            </div>
            <% if (stats.clubsCount >= 10) { %>
            <div class="col-12 col-md-4 mt-2 mt-md-0">
                <div class="stat-item-small">
                    <span class="stat-number-small"><%= stats.clubsCount %></span>
                    <span class="stat-label-small">Registered Clubs</span>
                </div>
            </div>
            <% } %>
        </div>
    </div>
</section>

<!-- Upcoming Carnivals Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="h3 mb-0">Upcoming Carnivals</h2>
                    <a href="/carnivals" class="btn btn-outline-primary">View All</a>
                </div>
                
                <% if (carnivals && carnivals.length > 0) { %>
                    <div class="row">
                        <% carnivals.forEach(carnival => { %>
                            <div class="col-md-6 mb-4">
                                <div class="card shadow-sm">
                                    <div class="row g-0">
                                        <div class="col-8">
                                            <div class="card-body p-3">
                                                <h6 class="card-title mb-2"><%= carnival.title %></h6>
                                                <div class="mb-1">
                                                    <small class="text-muted">
                                                        <i class="bi bi-calendar3"></i> 
                                                        <%= carnival.date.toLocaleDateString('en-AU', { 
                                                            month: 'short', 
                                                            day: 'numeric' 
                                                        }) %>
                                                    </small>
                                                </div>
                                                <div class="mb-2">
                                                    <small class="text-muted">
                                                        <i class="bi bi-geo-alt"></i> 
                                                        <%= carnival.locationAddress.length > 30 ? 
                                                            carnival.locationAddress.substring(0, 30) + '...' : 
                                                            carnival.locationAddress %>
                                                    </small>
                                                </div>
                                                <div class="mb-2">
                                                    <span class="badge bg-secondary"><%= carnival.state %></span>
                                                </div>
                                                <div class="d-flex gap-1">
                                                    <a href="/carnivals/<%= carnival.id %>" class="btn btn-primary btn-sm">
                                                        <i class="bi bi-eye"></i> View
                                                    </a>
                                                    <% if (carnival.registrationLink) { %>
                                                        <a href="<%= carnival.registrationLink %>" class="btn btn-outline-success btn-sm" target="_blank">
                                                            <i class="bi bi-person-plus"></i> Register
                                                        </a>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-4 d-flex align-items-center justify-content-center p-3">
                                            <% 
                                            // Show carnival logo first, then fall back to hosting club logo, then to missing.svg
                                            const logoUrl = carnival.clubLogoURL || (carnival.creator && carnival.creator.club && carnival.creator.club.logoUrl) || '/icons/missing.svg';
                                            %>
                                            <img src="<%= logoUrl %>" alt="Club Logo" 
                                                 class="img-fluid" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x display-4 text-muted mb-3"></i>
                        <h4 class="text-muted">No upcoming carnivals found</h4>
                        <p class="text-muted">Check back later or contact your local club to add their carnival.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>

<!-- Image Carousel Section -->
<% if (typeof carouselImages !== 'undefined' && carouselImages && carouselImages.length > 0) { %>
<section class="py-3 bg-light">
    <div class="container-fluid">
        <div class="image-carousel-container">
            <div class="image-carousel" id="imageCarousel">
                <!-- Images will be populated by JavaScript -->
            </div>
        </div>
    </div>
</section>
<% } %>

<!-- Email Subscription Section -->
<section id="subscribe" class="bg-light py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="h3 mb-4">Stay Updated</h2>
                <p class="mb-4">Subscribe to receive notifications about new carnivals in your selected states.</p>
                
                <form method="POST" action="/subscribe" class="needs-validation" novalidate>
                    <div class="row g-3 justify-content-center">
                        <div class="col-md-6">
                            <input type="email" class="form-control" name="email" placeholder="Enter your email" required>
                            <div class="invalid-feedback">Please provide a valid email.</div>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" name="state" multiple required size="8">
                                <option value="NSW">NSW</option>
                                <option value="QLD">QLD</option>
                                <option value="VIC">VIC</option>
                                <option value="WA">WA</option>
                                <option value="SA">SA</option>
                                <option value="TAS">TAS</option>
                                <option value="NT">NT</option>
                                <option value="ACT">ACT</option>
                            </select>
                            <div class="invalid-feedback">Please select at least one state.</div>
                            <div class="form-text">Hold Ctrl/Cmd to select multiple states</div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-envelope"></i> Subscribe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- MySideline Integration Section -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h2 class="h3 mb-4">Official Registration</h2>
                <p class="mb-4">
                    All official Masters Rugby League registrations are processed through MySideline. 
                    Find and register for Masters carnivals across Australia.
                </p>
                <a href="<%= process.env.MYSIDELINE_URL || '#' %>" class="btn btn-success btn-lg" target="_blank">
                    <i class="bi bi-box-arrow-up-right"></i> Register on MySideline
                </a>
            </div>
            <div class="col-lg-6 text-center">
                <i class="bi bi-person-check display-1 text-success"></i>
            </div>
        </div>
    </div>
</section>

<script>
    // Pass carousel images to client-side JavaScript
    <% if (typeof carouselImages !== 'undefined') { %>
        window.carouselImages = <%- JSON.stringify(carouselImages) %>;
    <% } else { %>
        window.carouselImages = [];
    <% } %>
</script>